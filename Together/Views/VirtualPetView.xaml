<UserControl x:Class="Together.Presentation.Views.VirtualPetView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="400">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Virtual Pet" 
                       Style="{StaticResource MaterialDesignHeadline5TextBlock}"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="{Binding PetName}" 
                       Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                       HorizontalAlignment="Center"
                       Margin="0,8,0,0"/>
        </StackPanel>

        <!-- Pet Display Area -->
        <Border Grid.Row="1" 
                Background="{DynamicResource MaterialDesignPaper}"
                CornerRadius="8"
                Padding="24"
                Margin="0,0,0,16">
            <Grid>
                <!-- Loading Indicator -->
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                             Value="0"
                             IsIndeterminate="True"
                             Width="60"
                             Height="60"
                             Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                <!-- Pet Display -->
                <StackPanel HorizontalAlignment="Center" 
                            VerticalAlignment="Center"
                            Visibility="{Binding IsLoading, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                    
                    <!-- Pet Animation/Image -->
                    <Viewbox Width="200" Height="200" Margin="0,0,0,24">
                        <Canvas Width="200" Height="200">
                            <!-- Pet Body (Circle) -->
                            <Ellipse Width="150" Height="150" 
                                     Canvas.Left="25" Canvas.Top="25">
                                <Ellipse.Fill>
                                    <SolidColorBrush>
                                        <SolidColorBrush.Color>
                                            <MultiBinding Converter="{StaticResource PetStateToColorConverter}">
                                                <Binding Path="State"/>
                                                <Binding Path="AppearanceOptions"/>
                                            </MultiBinding>
                                        </SolidColorBrush.Color>
                                    </SolidColorBrush>
                                </Ellipse.Fill>
                            </Ellipse>

                            <!-- Eyes -->
                            <Ellipse Width="20" Height="25" Fill="Black" Canvas.Left="60" Canvas.Top="70"/>
                            <Ellipse Width="20" Height="25" Fill="Black" Canvas.Left="120" Canvas.Top="70"/>

                            <!-- Mouth (changes based on state) -->
                            <Path Stroke="Black" StrokeThickness="3" Canvas.Left="70" Canvas.Top="120">
                                <Path.Data>
                                    <PathGeometry>
                                        <PathGeometry.Figures>
                                            <PathFigure StartPoint="0,0">
                                                <PathFigure.Segments>
                                                    <QuadraticBezierSegment Point1="30,15" Point2="60,0"/>
                                                </PathFigure.Segments>
                                            </PathFigure>
                                        </PathGeometry.Figures>
                                    </PathGeometry>
                                </Path.Data>
                            </Path>
                        </Canvas>
                    </Viewbox>

                    <!-- Pet State -->
                    <TextBlock Text="{Binding StateDisplay}" 
                               Style="{StaticResource MaterialDesignBody1TextBlock}"
                               HorizontalAlignment="Center"
                               FontWeight="Bold"
                               Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                </StackPanel>

                <!-- Error Message -->
                <TextBlock Text="{Binding ErrorMessage}"
                           Foreground="{DynamicResource MaterialDesignValidationErrorBrush}"
                           TextWrapping="Wrap"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}"/>
            </Grid>
        </Border>

        <!-- Level and XP Display -->
        <materialDesign:Card Grid.Row="2" Margin="0,0,0,16" Padding="16">
            <StackPanel>
                <Grid Margin="0,0,0,8">
                    <TextBlock Text="{Binding Level, StringFormat='Level {0}'}" 
                               Style="{StaticResource MaterialDesignSubtitle1TextBlock}"
                               HorizontalAlignment="Left"/>
                    <TextBlock HorizontalAlignment="Right">
                        <Run Text="{Binding ExperiencePoints, Mode=OneWay}"/>
                        <Run Text="/"/>
                        <Run Text="{Binding ExperienceToNextLevel, Mode=OneWay}"/>
                        <Run Text="XP"/>
                    </TextBlock>
                </Grid>

                <!-- XP Progress Bar -->
                <ProgressBar Value="{Binding ExperiencePercentage}"
                             Maximum="100"
                             Height="8"
                             Style="{StaticResource MaterialDesignLinearProgressBar}"/>
            </StackPanel>
        </materialDesign:Card>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center">
            <Button Content="CUSTOMIZE"
                    Command="{Binding OpenCustomizationCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Margin="0,0,8,0"/>
            <Button Content="REFRESH"
                    Command="{Binding RefreshCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}"/>
        </StackPanel>
    </Grid>
</UserControl>
